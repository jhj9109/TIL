			URL

Model View HTML

​			Template

Migra

ORM : CRUD > 

charfield와 textfield

- CharField : input과 대응, 길이제한
- TextField : textarea와 대응



장고 정적 파일 관리

- static 폴더 생성
  - stylesheets 폴더 생성
  - images 폴더 생성

- `{% load static %}`
- `href={% static 'stylesheets/style.css' %}`

- 규칙 하나 {% extends 'base.html' %}은 최상단 위치



git log --oneline

git clone

touch

`1 - 2 - 3 : 원격저장소 상태` / `1 - 2 - 4 push 로컬 거절`

git pull origin master : `vim`

esc:  wq



# 프로젝트

## 1. start

### root

- django-admin startproject 네임
- git init
- .gitignore

## 2. setting1

### root

- python startapp 네임

  

### setting.py

- ALLOWED_HOSTS = ['*']

- INSTALLED_APPS += ['community',]
- LANGUAGE_CODE = 'ko-kr'
- TIME_ZONE = 'Aisa/Seoul'

## 초기 index 생성

### django_project1

- urls.py에 views import후 path 등록

  

### community

- templates 폴더 생성후 index.html 생성
- views.py에 index 정의
  - render 빼먹을시 attribute at /index/ 에러를 맞보게됨

## templates 하위폴더 생성, base.html 적용

### root

- templates/ 생성

  - base.html 생성

    

### django_project1

- urls.py
  - `from django.urls import include`
  - `path('community/', include('community.urls'))` 
- settings.py
  - `TEMPLATES`에**`'DIRS': [os.path.join(BASE_DIR, 'templates' )` **



### community

- community/templates/
  - 하위 폴더 community/ 생성
    - index.html 옮김
    - 상속 : `{% extends 'base.html' %}` 

- urls.py 생성
  - path 등록
  - `from . import views`



# 탬플릿 생성

### community

- templates/community/
  - new_review.html, review_list.html 생성
- urls.py
  - path('new_review/', views.new_review)
  - path('create_review/', views.create_review)
- views.py
  - def new_review(request):
        return render (request, 'community/new_review.html')
  - def create_review(request):
        return render (request, 'community/create_review.html')



## Model

### django_project1

- setting.py
  - INSTALLED_APPS :` 'django-extensions'` 추가

### community

- models.py

  ```python	
  from django.db import models
  #models.Model 상속받아 클래스 선언
  class Article(models.Model):
      #리뷰제목
      title = models.CharField(max_length=140)
      #리뷰내용
      content = models.TextField()
      #리뷰평점
      rank = models.IntegerField()
      #리뷰최초작성시간
      created_at = models.DateTimeField(auto_now_add=True)
      #리뷰최종수정시간
      updated_at = models.DateTimeField(auto_now=True)
  ```

  - `auto_now_add` 생성시에만
  - `auto_now` : 수정시 마다

- migrations/

  - `python manage.py makemigrations` 모델 생성
    - 적용 : `python manage.py migrate`



## Admin

```bash
python manage.py createsuperuser
```

### community

- admin.py
  - from .models import Article
    admin.site.register(Article)



## 디버깅

`OperationalError: no such table: community_review`

- 모델 수정시, 마이그레이션과 dq.sqlite3 모두 지워야 하는데, 하나만 지웠음



## 게시판 마무리하기

### urls.py

- path('', views.index): 메인 조회 페이지

  -     {% for review in reviews %}
        <p>{{ review.id }}번글</p>
        <a href="/community/{{review.id}}/">제목: {{ review.title }}</a>
        <p>평점:{{ review.rank }}</p>
        <p>작성일: {{ review.created_at }}</p>
        <p>수정일: {{ review.updated_at }}</p>
        <hr>
        {% empty %}
        <p>목록이 없습니다.</p>
        {% endfor %}

- path('new_review/', views.new_review): 새 글 작성 폼으로 이동

  - ```python
    {% extends 'base.html' %}
    {% block body %}
        <form action="/community/create_review/">
          <div class="form-group">
            <label for="title">제목</label>
            <input type="title" class="form-control" id="title" name="title" placeholder="영화제목" required autofocus>
          </div>
          <div class="form-group">
            <label for="content">내용</label>
            <textarea class="form-control" id="content" name="content" placeholder="내용" required></textarea>
          </div>
          <div class="form-group">
            <label for="rank">평점</label>
            <input type="number" class="form-control" id="rank" name="rank" required>
          </div>
          <button class="btn btn-primary" type="submit">작성 완료</button>
        </form>
    
    {% endblock %}
    ```

    

- path('create_review/', views.create_review): 새 글 작성완료 & redirect(f'community/{Review.objects.last().id}/'

- path('`<int:pk>`/', views.review_detail): id번 글 상세 조회

  - ```python
    {% extends 'base.html' %}
    {% block body %}
    
        <h1>{{ review.pk }}번 글</h1>
        <p>{{ review.content }}</p>
        <p>평점: {{ review.rank }}</p>
        <p>최초 작성일: {{ review.created_at }}</p>
        <p>최종 수정일: {{ review.updated_at }}</p>
    
    {% endblock %}
    ```

### views.py

- 모든 리뷰들을 조회

```python
def index(request):
    reviews = Review.objects.all()
    context = {
        'reviews': reviews
    }
    return render (request, 'community/review_list.html', context)
```

- 새로운 글 작성 폼으로 이동

```python
def new_review(request):
    return render (request, 'community/new_review.html')
```

- 새로운 글 작성 완료, 상세보기로 리다이렉트

```python
def create_review(request):
    review = Review()
    review.title = request.GET.get('title')
    review.content = request.GET.get('content')
    review.rank = request.GET.get('rank')
    review.save()
    pk = Review.objects.last().id
    return redirect (f'/community/{pk}/')
```

- 상세보기

```python
def review_detail(request, pk):
    review = Review.objects.get(id=pk)
    context = {
        'review': review,
    }
    return render (request, 'community/review_detail.html', context)
```





